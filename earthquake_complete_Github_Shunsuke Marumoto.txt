ãƒãƒ£ãƒ¬ãƒ³ã‚¸1
Code Cellã¨Markdown Cell

import requests
import pandas as pd
from datetime import datetime, timedelta

# === 1. USGSã‹ã‚‰éå»1ãƒ¶æœˆã®åœ°éœ‡ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾— ===
end_time = datetime.utcnow()
start_time = end_time - timedelta(days=30)

url = "https://earthquake.usgs.gov/fdsnws/event/1/query"
params = {
    "format": "geojson",
    "starttime": start_time.strftime("%Y-%m-%d"),
    "endtime": end_time.strftime("%Y-%m-%d"),
    "minmagnitude": 1.0,  # M1.0ä»¥ä¸Šã«é™å®š
    "limit": 20000  # æœ€å¤§ä»¶æ•°
}

response = requests.get(url, params=params)
data = response.json()

# === 2. ãƒ‡ãƒ¼ã‚¿ã‚’DataFrameåŒ– ===
features = data["features"]
records = []
for f in features:
    props = f["properties"]
    coords = f["geometry"]["coordinates"]
    records.append({
        "time": datetime.utcfromtimestamp(props["time"] / 1000),
        "place": props["place"],
        "magnitude": props["mag"],
        "longitude": coords[0],
        "latitude": coords[1]
    })

df = pd.DataFrame(records)

# === 3. ç·æ•°ã‚’è¡¨ç¤º ===
total_quakes = len(df)
print(f"ğŸŒ éå»1ãƒ¶æœˆã®åœ°éœ‡ã®ç·æ•°: {total_quakes} ä»¶")

# === 4. æœ€å¤§ãƒã‚°ãƒ‹ãƒãƒ¥ãƒ¼ãƒ‰ã®åœ°éœ‡ ===
max_quake = df.loc[df["magnitude"].idxmax()]
print(f"ğŸ’¥ æœ€å¤§ãƒã‚°ãƒ‹ãƒãƒ¥ãƒ¼ãƒ‰: {max_quake['magnitude']}")
print(f"ğŸ“ ç™ºç”Ÿå ´æ‰€: {max_quake['place']}")
print(f"ğŸ•’ ç™ºç”Ÿæ—¥æ™‚(UTC): {max_quake['time']}")

# === 5. æ—¥æœ¬ä»˜è¿‘ã®åœ°éœ‡ã®ã¿æŠ½å‡º ===
# æ—¥æœ¬ä»˜è¿‘ã®ç·¯åº¦çµŒåº¦ç¯„å›²ã§ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆãŠãŠã‚ˆãï¼‰
japan_df = df[
    (df["latitude"].between(24, 46)) &
    (df["longitude"].between(122, 154))
].copy()

# æ—¥ã”ã¨ã®åœ°éœ‡æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
japan_df["date"] = japan_df["time"].dt.date
daily_counts = japan_df.groupby("date").size()

print("\nğŸ“… æ—¥æœ¬ä»˜è¿‘ã®åœ°éœ‡ç™ºç”Ÿæ•°ï¼ˆæ—¥ã”ã¨ï¼‰:")
print(daily_counts)

# === 6. çµæœã‚’CSVã«ä¿å­˜ã—ãŸã„å ´åˆ ===
# japan_df.to_csv("japan_earthquakes_last_month.csv", index=False)

å‡ºåŠ›ã•ã‚ŒãŸã‚‚ã®
C:\Users\shunk\AppData\Local\Temp\ipykernel_23592\2707493545.py:6: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  end_time = datetime.utcnow()
ğŸŒ éå»1ãƒ¶æœˆã®åœ°éœ‡ã®ç·æ•°: 5112 ä»¶
ğŸ’¥ æœ€å¤§ãƒã‚°ãƒ‹ãƒãƒ¥ãƒ¼ãƒ‰: 6.8
ğŸ“ ç™ºç”Ÿå ´æ‰€: 126 km E of Yamada, Japan
ğŸ•’ ç™ºç”Ÿæ—¥æ™‚(UTC): 2025-11-09 08:03:37.808000

ğŸ“… æ—¥æœ¬ä»˜è¿‘ã®åœ°éœ‡ç™ºç”Ÿæ•°ï¼ˆæ—¥ã”ã¨ï¼‰:
date
2025-10-13     2
2025-10-14     3
2025-10-15     2
2025-10-17     1
2025-10-18     3
2025-10-19     1
2025-10-20     1
2025-10-21     1
2025-10-22     1
2025-10-23     1
2025-10-24     5
2025-10-25     1
2025-10-26     2
2025-10-30     1
2025-11-01     1
2025-11-02     2
2025-11-03     2
2025-11-04     3
2025-11-05     2
2025-11-06     3
2025-11-07     2
2025-11-08    11
2025-11-09    29
2025-11-10    11
2025-11-11     1
dtype: int64
C:\Users\shunk\AppData\Local\Temp\ipykernel_23592\2707493545.py:28: DeprecationWarning: datetime.datetime.utcfromtimestamp() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.fromtimestamp(timestamp, datetime.UTC).
  "time": datetime.utcfromtimestamp(props["time"] / 1000),

ãƒãƒ£ãƒ¬ãƒ³ã‚¸2
Code Cellã¨Markdown Cell
import requests
from datetime import datetime, timedelta

# === 1. éå»1ãƒ¶æœˆã®åœ°éœ‡ãƒ‡ãƒ¼ã‚¿ã‚’USGSã‹ã‚‰å–å¾— ===
end_time = datetime.utcnow()
start_time = end_time - timedelta(days=30)

url = "https://earthquake.usgs.gov/fdsnws/event/1/query"
params = {
    "format": "geojson",
    "starttime": start_time.strftime("%Y-%m-%d"),
    "endtime": end_time.strftime("%Y-%m-%d"),
    "minmagnitude": 1.0,  # M1ä»¥ä¸Š
    "limit": 20000
}

response = requests.get(url, params=params)
data = response.json()

# === 2. featuresã‹ã‚‰åœ°éœ‡ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡º ===
features = data["features"]

# === 3. é‡è¦ãªåœ°éœ‡ï¼ˆM6.0è¶…ï¼‰ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° ===
important_quakes = []
for f in features:
    props = f["properties"]
    mag = props["mag"]
    place = props["place"]
    time = datetime.utcfromtimestamp(props["time"] / 1000)
    if mag and mag > 6.0:
        important_quakes.append({
            "place": place,
            "magnitude": mag,
            "time": time
        })

# === 4. çµæœã‚’è¡¨ç¤º ===
print("ğŸŒ‹ ãƒã‚°ãƒ‹ãƒãƒ¥ãƒ¼ãƒ‰6.0ã‚’è¶…ãˆã‚‹åœ°éœ‡ï¼ˆéå»1ãƒ¶æœˆï¼‰:")
print("-" * 60)

for quake in important_quakes:
    print(f"ğŸ“ ä½ç½®: {quake['place']}")
    print(f"ğŸ’¥ ãƒã‚°ãƒ‹ãƒãƒ¥ãƒ¼ãƒ‰: {quake['magnitude']}")
    print(f"ğŸ•’ ç™ºç”Ÿæ™‚åˆ»(UTC): {quake['time']}")
    print("-" * 60)

print(f"ğŸ”¢ é‡è¦ãªåœ°éœ‡ã®ç·æ•°: {len(important_quakes)} ä»¶")

å‡ºåŠ›ã•ã‚ŒãŸã‚‚ã®

C:\Users\shunk\AppData\Local\Temp\ipykernel_23592\2299699479.py:5: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  end_time = datetime.utcnow()
ğŸŒ‹ ãƒã‚°ãƒ‹ãƒãƒ¥ãƒ¼ãƒ‰6.0ã‚’è¶…ãˆã‚‹åœ°éœ‡ï¼ˆéå»1ãƒ¶æœˆï¼‰:
------------------------------------------------------------
ğŸ“ ä½ç½®: 121 km E of Yamada, Japan
ğŸ’¥ ãƒã‚°ãƒ‹ãƒãƒ¥ãƒ¼ãƒ‰: 6.4
ğŸ•’ ç™ºç”Ÿæ™‚åˆ»(UTC): 2025-11-09 08:54:36.991000
------------------------------------------------------------
ğŸ“ ä½ç½®: 126 km E of Yamada, Japan
ğŸ’¥ ãƒã‚°ãƒ‹ãƒãƒ¥ãƒ¼ãƒ‰: 6.8
ğŸ•’ ç™ºç”Ÿæ™‚åˆ»(UTC): 2025-11-09 08:03:37.808000
------------------------------------------------------------
ğŸ“ ä½ç½®: 155 km SE of Petropavlovsk-Kamchatsky, Russia
ğŸ’¥ ãƒã‚°ãƒ‹ãƒãƒ¥ãƒ¼ãƒ‰: 6.1
ğŸ•’ ç™ºç”Ÿæ™‚åˆ»(UTC): 2025-11-03 08:44:43.471000
------------------------------------------------------------
ğŸ“ ä½ç½®: 22 km WSW of Khulm, Afghanistan
ğŸ’¥ ãƒã‚°ãƒ‹ãƒãƒ¥ãƒ¼ãƒ‰: 6.3
ğŸ•’ ç™ºç”Ÿæ™‚åˆ»(UTC): 2025-11-02 20:29:02.028000
------------------------------------------------------------
ğŸ“ ä½ç½®: Banda Sea
ğŸ’¥ ãƒã‚°ãƒ‹ãƒãƒ¥ãƒ¼ãƒ‰: 6.4
ğŸ•’ ç™ºç”Ÿæ™‚åˆ»(UTC): 2025-10-28 14:40:18.476000
------------------------------------------------------------
ğŸ“ ä½ç½®: 162 km E of BeausÃ©jour, Guadeloupe
ğŸ’¥ ãƒã‚°ãƒ‹ãƒãƒ¥ãƒ¼ãƒ‰: 6.5
ğŸ•’ ç™ºç”Ÿæ™‚åˆ»(UTC): 2025-10-27 12:38:40.311000
------------------------------------------------------------
ğŸ“ ä½ç½®: 59 km NW of Pante Makasar, Timor Leste
ğŸ’¥ ãƒã‚°ãƒ‹ãƒãƒ¥ãƒ¼ãƒ‰: 6.2
ğŸ•’ ç™ºç”Ÿæ™‚åˆ»(UTC): 2025-10-26 17:04:25.645000
------------------------------------------------------------
ğŸ“ ä½ç½®: 194 km WNW of Abepura, Indonesia
ğŸ’¥ ãƒã‚°ãƒ‹ãƒãƒ¥ãƒ¼ãƒ‰: 6.5
ğŸ•’ ç™ºç”Ÿæ™‚åˆ»(UTC): 2025-10-16 05:48:55.498000
------------------------------------------------------------
ğŸ“ ä½ç½®: Drake Passage
ğŸ’¥ ãƒã‚°ãƒ‹ãƒãƒ¥ãƒ¼ãƒ‰: 6.3
ğŸ•’ ç™ºç”Ÿæ™‚åˆ»(UTC): 2025-10-16 01:42:32.318000
------------------------------------------------------------
ğŸ”¢ é‡è¦ãªåœ°éœ‡ã®ç·æ•°: 9 ä»¶
C:\Users\shunk\AppData\Local\Temp\ipykernel_23592\2299699479.py:29: DeprecationWarning: datetime.datetime.utcfromtimestamp() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.fromtimestamp(timestamp, datetime.UTC).
  time = datetime.utcfromtimestamp(props["time"] / 1000)

ãƒãƒ£ãƒ¬ãƒ³ã‚¸3
Code Cellã¨Markdown Cell
import requests
from datetime import datetime, timedelta

# === 1. USGS API ã‹ã‚‰éå»30æ—¥ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾— ===
end_time = datetime.utcnow()
start_time = end_time - timedelta(days=30)

url = "https://earthquake.usgs.gov/fdsnws/event/1/query"
params = {
    "format": "geojson",
    "starttime": start_time.strftime("%Y-%m-%d"),
    "endtime": end_time.strftime("%Y-%m-%d"),
    "minmagnitude": 1.0,
    "limit": 20000
}

response = requests.get(url, params=params)
data = response.json()

# === 2. features ã‹ã‚‰æ·±ã•ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡º ===
features = data["features"]

depths = []
for f in features:
    geom = f["geometry"]
    if geom and "coordinates" in geom:
        coords = geom["coordinates"]
        if len(coords) == 3:
            depth = coords[2]  # æ·±ã•ã¯3ç•ªç›®ã®è¦ç´ 
            depths.append(depth)

# === 3. å¹³å‡æ·±åº¦ã®è¨ˆç®— ===
if len(depths) > 0:
    avg_depth = sum(depths) / len(depths)
else:
    avg_depth = 0

# === 4. æ·±ã•ã‚«ãƒ†ã‚´ãƒªã”ã¨ã«ã‚«ã‚¦ãƒ³ãƒˆ ===
shallow = len([d for d in depths if d < 70])
intermediate = len([d for d in depths if 70 <= d <= 300])
deep = len([d for d in depths if d > 300])

# === 5. çµæœã‚’å‡ºåŠ› ===
print("ğŸŒ éå»1ãƒ¶æœˆã®åœ°éœ‡æ·±åº¦åˆ†æ (USGS)")
print("-" * 50)
print(f"ğŸ“Š å¹³å‡æ·±åº¦: {avg_depth:.2f} km")
print(f"ğŸŸ¢ æµ…ã„åœ°éœ‡ (<70km): {shallow} ä»¶")
print(f"ğŸŸ¡ ä¸­é–“æ·±åº¦åœ°éœ‡ (70â€“300km): {intermediate} ä»¶")
print(f"ğŸ”µ æ·±ã„åœ°éœ‡ (>300km): {deep} ä»¶")
print(f"ğŸ“ˆ ç·åœ°éœ‡æ•°: {len(depths)} ä»¶")

å‡ºåŠ›ã•ã‚ŒãŸã‚‚ã®

C:\Users\shunk\AppData\Local\Temp\ipykernel_23592\33301874.py:5: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  end_time = datetime.utcnow()
ğŸŒ éå»1ãƒ¶æœˆã®åœ°éœ‡æ·±åº¦åˆ†æ (USGS)
--------------------------------------------------
ğŸ“Š å¹³å‡æ·±åº¦: 27.97 km
ğŸŸ¢ æµ…ã„åœ°éœ‡ (<70km): 4563 ä»¶
ğŸŸ¡ ä¸­é–“æ·±åº¦åœ°éœ‡ (70â€“300km): 489 ä»¶
ğŸ”µ æ·±ã„åœ°éœ‡ (>300km): 60 ä»¶
ğŸ“ˆ ç·åœ°éœ‡æ•°: 5112 ä»¶

ãƒãƒ£ãƒ¬ãƒ³ã‚¸4
Code Cellã¨Markdown Cell
import requests
from datetime import datetime, timedelta, timezone

# === 1. USGS API ã‹ã‚‰éå»30æ—¥ã®åœ°éœ‡ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾— ===
end_time = datetime.utcnow()
start_time = end_time - timedelta(days=30)

url = "https://earthquake.usgs.gov/fdsnws/event/1/query"
params = {
    "format": "geojson",
    "starttime": start_time.strftime("%Y-%m-%d"),
    "endtime": end_time.strftime("%Y-%m-%d"),
    "minmagnitude": 1.0,
    "limit": 20000
}

response = requests.get(url, params=params)
data = response.json()

# === 2. JSTï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰ç”¨ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’å®šç¾© ===
JST = timezone(timedelta(hours=9))

# === 3. ã™ã¹ã¦ã®åœ°éœ‡ã®æ™‚åˆ»ã‚’ãƒªã‚¹ãƒˆåŒ–ï¼ˆUNIX ms â†’ datetime JSTï¼‰ ===
times_jst = []
for f in data["features"]:
    t_ms = f["properties"]["time"]  # ãƒŸãƒªç§’å˜ä½ã®UNIXæ™‚é–“
    t_jst = datetime.fromtimestamp(t_ms / 1000, tz=JST)
    times_jst.append(t_jst)

# === 4. æœ€ã‚‚æ—©ã„ï¼ˆå¤ã„ï¼‰åœ°éœ‡ã¨æœ€æ–°ã®åœ°éœ‡ã‚’ç‰¹å®š ===
if times_jst:
    earliest = min(times_jst)
    latest = max(times_jst)
else:
    earliest = latest = None

# === 5. çµæœã‚’è¡¨ç¤º ===
print("ğŸ•’ USGS åœ°éœ‡ãƒ‡ãƒ¼ã‚¿ æ™‚é–“åˆ†æï¼ˆéå»1ãƒ¶æœˆï¼‰")
print("-" * 60)
print(f"ğŸ“… ç·åœ°éœ‡æ•°: {len(times_jst)} ä»¶")
if earliest and latest:
    print(f"â° æœ€ã‚‚æ—©ã„åœ°éœ‡ï¼ˆæœ€å¤ï¼‰: {earliest.strftime('%Y-%m-%d %H:%M:%S %Z')}")
    print(f"ğŸ•˜ æœ€æ–°ã®åœ°éœ‡: {latest.strftime('%Y-%m-%d %H:%M:%S %Z')}")
else:
    print("âš ï¸ ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚")

å‡ºåŠ›ã•ã‚ŒãŸã‚‚ã®

C:\Users\shunk\AppData\Local\Temp\ipykernel_23592\206779130.py:5: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  end_time = datetime.utcnow()
ğŸ•’ USGS åœ°éœ‡ãƒ‡ãƒ¼ã‚¿ æ™‚é–“åˆ†æï¼ˆéå»1ãƒ¶æœˆï¼‰
------------------------------------------------------------
ğŸ“… ç·åœ°éœ‡æ•°: 5112 ä»¶
â° æœ€ã‚‚æ—©ã„åœ°éœ‡ï¼ˆæœ€å¤ï¼‰: 2025-10-13 09:03:49 UTC+09:00
ğŸ•˜ æœ€æ–°ã®åœ°éœ‡: 2025-11-12 08:54:24 UTC+09:00

ãƒãƒ£ãƒ¬ãƒ³ã‚¸5
Code Cellã¨Markdown Cell
å§‹ã‚ã«
pip install requests matplotlib
æ¬¡ã«ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§â†“ã‚’å®Ÿè¡Œ
python usgs_quake_plot.py
æœ€å¾Œã«
import requests
import matplotlib.pyplot as plt

# === USGS ã‹ã‚‰éå»1ãƒ¶æœˆã®åœ°éœ‡ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾— ===
url = "https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_month.geojson"
response = requests.get(url)
response.raise_for_status()
data = response.json()

features = data["features"]

# === ãƒ‡ãƒ¼ã‚¿æŠ½å‡º ===
magnitudes = []
depths = []
locations = []

for quake in features:
    props = quake["properties"]
    geom = quake["geometry"]

    if props["mag"] is not None and geom and geom["coordinates"]:
        mag = props["mag"]
        depth = geom["coordinates"][2]  # æ·±ã•ï¼ˆkmï¼‰
        loc = props["place"] or "Unknown location"

        magnitudes.append(mag)
        depths.append(depth)
        locations.append(loc)

# === æœ€å¤§ãƒã‚°ãƒ‹ãƒãƒ¥ãƒ¼ãƒ‰ã¨æœ€å¤§æ·±åº¦ã‚’ç‰¹å®š ===
max_mag = max(magnitudes)
max_depth = max(depths)

max_mag_index = magnitudes.index(max_mag)
max_depth_index = depths.index(max_depth)

max_mag_loc = locations[max_mag_index]
max_depth_loc = locations[max_depth_index]

# === æ•£å¸ƒå›³ã‚’ä½œæˆ ===
plt.figure(figsize=(10, 6))
plt.scatter(magnitudes, depths, alpha=0.6, label="Earthquakes")

# æœ€å¤§ãƒã‚°ãƒ‹ãƒãƒ¥ãƒ¼ãƒ‰ã®åœ°éœ‡ã‚’èµ¤ã§è¡¨ç¤º
plt.scatter(max_mag, depths[max_mag_index], color="red", s=100, label="Max Magnitude")
plt.text(max_mag, depths[max_mag_index], f"{max_mag_loc}\nM{max_mag:.1f}", fontsize=8, color="red")

# æœ€ã‚‚æ·±ã„åœ°éœ‡ã‚’é’ã§è¡¨ç¤º
plt.scatter(magnitudes[max_depth_index], max_depth, color="blue", s=100, label="Deepest Quake")
plt.text(magnitudes[max_depth_index], max_depth, f"{max_depth_loc}\n{max_depth:.0f}km", fontsize=8, color="blue")

# === è»¸ã¨ã‚¿ã‚¤ãƒˆãƒ« ===
plt.title("Earthquakes (Past Month, USGS Data)", fontsize=14)
plt.xlabel("Magnitude")
plt.ylabel("Depth (km)")
plt.gca().invert_yaxis()  # æ·±ã„åœ°éœ‡ã»ã©ä¸‹ã«
plt.legend()
plt.grid(True)
plt.tight_layout()
plt.show()

å‡ºåŠ›ã•ã‚ŒãŸã‚‚ã®
import requests
import matplotlib.pyplot as plt

import requests
import matplotlib.pyplot as plt

# === USGS ã‹ã‚‰éå»1ãƒ¶æœˆã®åœ°éœ‡ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾— ===
url = "https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_month.geojson"
response = requests.get(url)
response.raise_for_status()
data = response.json()

features = data["features"]

# === ãƒ‡ãƒ¼ã‚¿æŠ½å‡º ===
magnitudes = []
depths = []
locations = []

for quake in features:
    props = quake["properties"]
    geom = quake["geometry"]

    if props["mag"] is not None and geom and geom["coordinates"]:
        mag = props["mag"]
        depth = geom["coordinates"][2]  # æ·±ã•ï¼ˆkmï¼‰
        loc = props["place"] or "Unknown location"

        magnitudes.append(mag)
        depths.append(depth)
        locations.append(loc)

# === æœ€å¤§ãƒã‚°ãƒ‹ãƒãƒ¥ãƒ¼ãƒ‰ã¨æœ€å¤§æ·±åº¦ã‚’ç‰¹å®š ===
max_mag = max(magnitudes)
max_depth = max(depths)

max_mag_index = magnitudes.index(max_mag)
max_depth_index = depths.index(max_depth)

max_mag_loc = locations[max_mag_index]
max_depth_loc = locations[max_depth_index]

# === æ•£å¸ƒå›³ã‚’ä½œæˆ ===
plt.figure(figsize=(10, 6))
plt.scatter(magnitudes, depths, alpha=0.6, label="Earthquakes")

# æœ€å¤§ãƒã‚°ãƒ‹ãƒãƒ¥ãƒ¼ãƒ‰ã®åœ°éœ‡ã‚’èµ¤ã§è¡¨ç¤º
plt.scatter(max_mag, depths[max_mag_index], color="red", s=100, label="Max Magnitude")
plt.text(max_mag, depths[max_mag_index], f"{max_mag_loc}\nM{max_mag:.1f}", fontsize=8, color="red")

# æœ€ã‚‚æ·±ã„åœ°éœ‡ã‚’é’ã§è¡¨ç¤º
plt.scatter(magnitudes[max_depth_index], max_depth, color="blue", s=100, label="Deepest Quake")
plt.text(magnitudes[max_depth_index], max_depth, f"{max_depth_loc}\n{max_depth:.0f}km", fontsize=8, color="blue")

# === è»¸ã¨ã‚¿ã‚¤ãƒˆãƒ« ===
plt.title("Earthquakes (Past Month, USGS Data)", fontsize=14)
plt.xlabel("Magnitude")
plt.ylabel("Depth (km)")
plt.gca().invert_yaxis()  # æ·±ã„åœ°éœ‡ã»ã©ä¸‹ã«
plt.legend()
plt.grid(True)
plt.tight_layout()
plt.show()

å‡ºåŠ›ã•ã‚ŒãŸã‚‚ã®

<Figure size 1000x600 with 1 Axes>

ãƒãƒ£ãƒ¬ãƒ³ã‚¸6
Code Cellã¨Markdown Cell

pip install requests folium pytz


å‡ºåŠ›ã•ã‚ŒãŸã‚‚ã®

Requirement already satisfied: requests in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (2.32.5)
Requirement already satisfied: folium in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (0.20.0)
Requirement already satisfied: pytz in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (2025.2)
Requirement already satisfied: charset_normalizer<4,>=2 in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (from requests) (3.4.4)
Requirement already satisfied: idna<4,>=2.5 in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (from requests) (3.11)
Requirement already satisfied: urllib3<3,>=1.21.1 in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (from requests) (2.5.0)
Requirement already satisfied: certifi>=2017.4.17 in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (from requests) (2025.10.5)
Requirement already satisfied: branca>=0.6.0 in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (from folium) (0.8.2)
Requirement already satisfied: jinja2>=2.9 in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (from folium) (3.1.6)
Requirement already satisfied: numpy in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (from folium) (2.3.4)
Requirement already satisfied: xyzservices in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (from folium) (2025.10.0)
Requirement already satisfied: MarkupSafe>=2.0 in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (from jinja2>=2.9->folium) (3.0.3)
Note: you may need to restart the kernel to use updated packages.

[notice] A new release of pip is available: 25.2 -> 25.3
[notice] To update, run: python.exe -m pip install --upgrade pip


Code Cellã¨Markdown Cell

# earthquake_map_folium.py
import requests
import folium
from folium import Tooltip
from datetime import datetime, timezone
import pytz

# --- ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š: ã“ã“ã‚’å¤‰ãˆã‚Œã°ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ‰ã«ã‚‚åˆ‡ã‚Šæ›¿ãˆå¯ ---
# éå»30æ—¥åˆ†ï¼ˆå…¨ã¦ã®åœ°éœ‡ï¼‰
USGS_GEOJSON_URL = "https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_month.geojson"
# ä»£æ›¿ä¾‹: all_week.geojson, all_day.geojson, 2.5_week.geojson ãªã©
# --- /è¨­å®š ---

def mag_to_color(mag):
    try:
        if mag is None:
            return "gray"
        mag = float(mag)
        if mag < 4.0:
            return "green"
        elif mag <= 6.0:
            return "orange"  # é»„è‰²ç³»ï¼ˆfoliumæ¨™æº–è‰²ã«åˆã‚ã›ã¦ orangeï¼‰
        else:
            return "red"
    except:
        return "gray"

def fetch_usgs_geojson(url):
    r = requests.get(url, timeout=20)
    r.raise_for_status()
    return r.json()

def utc_ms_to_jst_string(ms_since_epoch):
    # USGS ã® time ã¯ milliseconds since epoch (UTC)
    try:
        ts = int(ms_since_epoch) / 1000.0
        dt_utc = datetime.fromtimestamp(ts, tz=timezone.utc)
        jst = pytz.timezone("Asia/Tokyo")
        dt_jst = dt_utc.astimezone(jst)
        return dt_jst.strftime("%Y-%m-%d %H:%M:%S")
    except:
        return "N/A"

def create_map(features, start_location=(20,0), start_zoom=2):
    m = folium.Map(location=start_location, zoom_start=start_zoom, tiles="OpenStreetMap")
    for feat in features:
        props = feat.get("properties", {})
        geom = feat.get("geometry", {})
        coords = geom.get("coordinates", [None, None, None])  # [lon, lat, depth]
        lon, lat = coords[0], coords[1]
        depth = coords[2] if len(coords) > 2 else None

        mag = props.get("mag")
        place = props.get("place", "Unknown place")
        time_ms = props.get("time")  # milliseconds since epoch

        if lat is None or lon is None:
            continue

        color = mag_to_color(mag)
        radius = 3 + (float(mag) if mag is not None else 0) * 2  # ãƒã‚°ãƒ‹ãƒãƒ¥ãƒ¼ãƒ‰ã«å¿œã˜ãŸå¤§ãã•

        # ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ï¼ˆhoverã§è¡¨ç¤ºï¼‰
        tooltip_text = (
            f"<b>Place:</b> {place}<br>"
            f"<b>Mag:</b> {mag}<br>"
            f"<b>Date (JST):</b> {utc_ms_to_jst_string(time_ms)}<br>"
            f"<b>Depth:</b> {depth} km"
        )
        tooltip = Tooltip(tooltip_text, sticky=True)  # sticky=True ã§ãƒã‚¦ã‚¹ã‚’è¼‰ã›ãŸã¨ãè¡¨ç¤ºã‚’å®‰å®šã•ã›ã‚‹

        folium.CircleMarker(
            location=(lat, lon),
            radius=radius,
            color=color,
            fill=True,
            fill_opacity=0.7,
            weight=0.5,
            tooltip=tooltip
        ).add_to(m)

    return m

def main():
    print("Fetching USGS GeoJSON feed ...")
    geo = fetch_usgs_geojson(USGS_GEOJSON_URL)
    features = geo.get("features", [])
    print(f"Number of features (quakes) fetched: {len(features)}")

    print("Creating map ...")
    m = create_map(features)
    out_html = "usgs_earthquakes_map.html"
    m.save(out_html)
    print(f"Map saved to {out_html} â€” open this file in your browser.")

if __name__ == "__main__":
    main()



å‡ºåŠ›ã•ã‚ŒãŸã‚‚ã®

Fetching USGS GeoJSON feed ...
Number of features (quakes) fetched: 7297
Creating map ...
Map saved to usgs_earthquakes_map.html â€” open this file in your browser.


Code Cellã¨Markdown Cell

pip install folium pandas requests

å‡ºåŠ›ã•ã‚ŒãŸã‚‚ã®

Requirement already satisfied: folium in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (0.20.0)
Requirement already satisfied: pandas in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (2.3.3)
Requirement already satisfied: requests in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (2.32.5)
Requirement already satisfied: branca>=0.6.0 in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (from folium) (0.8.2)
Requirement already satisfied: jinja2>=2.9 in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (from folium) (3.1.6)
Requirement already satisfied: numpy in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (from folium) (2.3.4)
Requirement already satisfied: xyzservices in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (from folium) (2025.10.0)
Requirement already satisfied: python-dateutil>=2.8.2 in c:\users\shunk\appdata\roaming\python\python313\site-packages (from pandas) (2.9.0.post0)
Requirement already satisfied: pytz>=2020.1 in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (from pandas) (2025.2)
Requirement already satisfied: tzdata>=2022.7 in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (from pandas) (2025.2)
Requirement already satisfied: charset_normalizer<4,>=2 in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (from requests) (3.4.4)
Requirement already satisfied: idna<4,>=2.5 in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (from requests) (3.11)
Requirement already satisfied: urllib3<3,>=1.21.1 in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (from requests) (2.5.0)
Requirement already satisfied: certifi>=2017.4.17 in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (from requests) (2025.10.5)
Requirement already satisfied: MarkupSafe>=2.0 in c:\users\shunk\appdata\local\programs\python\python313\lib\site-packages (from jinja2>=2.9->folium) (3.0.3)
Requirement already satisfied: six>=1.5 in c:\users\shunk\appdata\roaming\python\python313\site-packages (from python-dateutil>=2.8.2->pandas) (1.17.0)
Note: you may need to restart the kernel to use updated packages.

[notice] A new release of pip is available: 25.2 -> 25.3
[notice] To update, run: python.exe -m pip install --upgrade pip


Code Cellã¨Markdown Cell

import requests
import pandas as pd
import folium
from datetime import datetime, timedelta, timezone

# ===== 1ï¸âƒ£ USGSã‹ã‚‰åœ°éœ‡ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾— =====
# å…¨ä¸–ç•Œã®éå»30æ—¥é–“ã®åœ°éœ‡ãƒ‡ãƒ¼ã‚¿ï¼ˆGeoJSONå½¢å¼ï¼‰
url = "https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_month.geojson"
data = requests.get(url).json()

# ===== 2ï¸âƒ£ å¿…è¦ãƒ‡ãƒ¼ã‚¿ã‚’DataFrameåŒ– =====
records = []
for feature in data["features"]:
    props = feature["properties"]
    coords = feature["geometry"]["coordinates"]
    lon, lat, depth = coords
    mag = props["mag"]
    place = props["place"]
    time_utc = datetime.utcfromtimestamp(props["time"] / 1000)
    
    # æ—¥æœ¬æ™‚é–“ã«å¤‰æ›
    jst = timezone(timedelta(hours=9))
    time_jst = time_utc.replace(tzinfo=timezone.utc).astimezone(jst)
    
    records.append({
        "place": place,
        "mag": mag,
        "depth": depth,
        "lat": lat,
        "lon": lon,
        "time_jst": time_jst.strftime("%Y-%m-%d %H:%M:%S")
    })

df = pd.DataFrame(records)

# ===== 3ï¸âƒ£ ãƒãƒ¼ã‚«ãƒ¼ã®è‰²ã‚’è¨­å®š =====
def color_by_magnitude(mag):
    if mag < 4.0:
        return "green"
    elif 4.0 <= mag <= 6.0:
        return "orange"
    else:
        return "red"

# ===== 4ï¸âƒ£ Foliumãƒãƒƒãƒ—ä½œæˆ =====
m = folium.Map(location=[0, 0], zoom_start=2, tiles="CartoDB positron")

# ===== 5ï¸âƒ£ åœ°éœ‡ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒƒãƒ—ã«è¿½åŠ  =====
for _, row in df.iterrows():
    tooltip = (f"<b>å ´æ‰€:</b> {row['place']}<br>"
               f"<b>ãƒã‚°ãƒ‹ãƒãƒ¥ãƒ¼ãƒ‰:</b> {row['mag']}<br>"
               f"<b>æ·±ã•:</b> {row['depth']} km<br>"
               f"<b>æ—¥æ™‚(æ—¥æœ¬æ™‚é–“):</b> {row['time_jst']}")
    
    folium.CircleMarker(
        location=[row["lat"], row["lon"]],
        radius=4 + (row["mag"] or 0) * 1.5,  # ãƒã‚°ãƒ‹ãƒãƒ¥ãƒ¼ãƒ‰ã«å¿œã˜ã¦å¤§ãã•èª¿æ•´
        color=color_by_magnitude(row["mag"]),
        fill=True,
        fill_color=color_by_magnitude(row["mag"]),
        fill_opacity=0.7,
        tooltip=tooltip
    ).add_to(m)

# ===== 6ï¸âƒ£ ä¿å­˜ =====
m.save("global_earthquake_map.html")
print("âœ… åœ°éœ‡ãƒãƒƒãƒ—ã‚’ 'global_earthquake_map.html' ã¨ã—ã¦ä¿å­˜ã—ã¾ã—ãŸã€‚")

å‡ºåŠ›ã•ã‚ŒãŸã‚‚ã®

C:\Users\shunk\AppData\Local\Temp\ipykernel_24932\2258094900.py:19: DeprecationWarning: datetime.datetime.utcfromtimestamp() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.fromtimestamp(timestamp, datetime.UTC).
  time_utc = datetime.utcfromtimestamp(props["time"] / 1000)
âœ… åœ°éœ‡ãƒãƒƒãƒ—ã‚’ 'global_earthquake_map.html' ã¨ã—ã¦ä¿å­˜ã—ã¾ã—ãŸã€‚


Code Cellã¨Markdown Cell

import webbrowser
import os

path = r"C:\Users\shunk\Downloads\global_earthquake_map.html"
webbrowser.open(f"file:///{os.path.abspath(path)}")
ã“ã‚Œã‚’å®Ÿè¡Œã™ã‚Œã°ã€ä½œæˆã—ãŸåœ°å›³ãŒå‡ºã¦ãã¾ã™ã€‚

ã‚„ã£ãŸã“ã¨

èª²é¡Œã«æ²¿ã£ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’ã—ã¾ã—ãŸã€‚
ã¾ãŸãã®ãŸã‚ã«ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚‚ã®ã‚‚ã‚ã‚Šã¾ã—ãŸã€‚
ãƒãƒ£ãƒ¬ãƒ³ã‚¸6ã¯æœ€å¾Œã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚Œã°åœ°å›³ã‚’é–‹ã‘ã¾ã™ã€‚
ãƒãƒ£ãƒ¬ãƒ³ã‚¸5ã®ç”»åƒã¯Pythonã§ã¯åæ˜ ã•ã‚Œã¾ã—ãŸãŒã€Githubã§ã¯ç”»åƒ§ãŒåæ˜ ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚

ã‚ã‹ã£ãŸã“ã¨

åœ°çƒå…¨ä½“ã§ã¯åœ°éœ‡ãŒæ´»ç™ºã«èµ·ãã¦ã„ã¾ã—ãŸã€‚
1ã‹æœˆã§5112ä»¶ã¨ã„ã†ã®ã¯ã€å¹³å‡ã—ã¦1æ—¥ã‚ãŸã‚Šç´„170ä»¶ä»¥ä¸Šç™ºç”Ÿã—ã¦ã„ã‚‹ã®ã§ã€
ã“ã‚Œã¯åœ°éœ‡ãŒå¸¸ã«ã©ã“ã‹ã§èµ·ãã¦ã„ã‚‹ã“ã¨ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚
ç‰¹ã«åœ°éœ‡å¸¯ï¼ˆå¤ªå¹³æ´‹ãƒ—ãƒ¬ãƒ¼ãƒˆå‘¨è¾ºã‚„ã‚¤ãƒ³ãƒ‰ãƒã‚·ã‚¢ã€æ—¥æœ¬ã€ãªã©ï¼‰ã§ã¯ã€åœ°éœ‡ãŒå¸¸æ™‚æ´»ç™ºã§ã™ã€‚
M6.0ä»¥ä¸Šã®åœ°éœ‡ãŒ9ä»¶ã¨ã„ã†ã®ã¯ã€ä¸–ç•Œå…¨ä½“ã§ã¯é€šå¸¸ã®ç™ºç”Ÿé »åº¦ã«è¿‘ã„ã§ã™ã€‚
ç‰¹ã«ã€M6.8ï¼ˆE of Yamada, Japanï¼‰ã®ã‚ˆã†ãªå·¨å¤§åœ°éœ‡ã‚‚ç™ºç”Ÿã—ã¦ã„ã¾ã™ã€‚
æµ…ã„åœ°éœ‡ãŒåœ§å€’çš„ã«å¤šãã€æµ…ã„åœ°éœ‡ï¼ˆ70kmæœªæº€ï¼‰ãŒç´„89%ï¼ˆ4563ä»¶ï¼‰ã‚’å ã‚ã¦ã„ã¾ã™ã€‚
æ—¥æœ¬ã§ã¯11æœˆ9æ—¥ã«29å›ã®åœ°éœ‡ãŒç™ºç”Ÿã—ã¦ã„ã¾ã™ã€‚
ç‰¹å®šã®æ—¥ã«é›†ä¸­ã—ã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªãã€åœ°éœ‡æ´»å‹•ã¯æ™‚é–“çš„ã«ã‚‚åºƒãåˆ†æ•£ã—ã¦ã„ã¾ã™ã€‚
ã¤ã¾ã‚Šã€åœ°éœ‡ã®ãªã„æ—¥ã¯ã»ã¨ã‚“ã©ãªã„ã¨ã„ã†ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

æ„Ÿã˜ãŸã“ã¨

ãƒ‡ãƒ¼ã‚¿ã‚’æ•°å€¤ã§è¦‹ã‚‹ã¨ã€åœ°éœ‡ãŒç‰¹åˆ¥ãªå‡ºæ¥äº‹ã§ã¯ãªãã€æ—¥å¸¸çš„ãªç¾è±¡ã§ã‚ã‚‹ã“ã¨ã‚’å®Ÿæ„Ÿã—ã¾ã—ãŸã€‚
ã¾ãŸã€ãã®ä¸­ã§ã€ŒM6ä»¥ä¸Šã€ãªã©ã®å¤§ããªåœ°éœ‡ãŒèµ·ãã‚‹ã¨ã€åœ°éœ‡ã®æ€–ã•ã‚’æ”¹ã‚ã¦èªè­˜ã—ã¾ã—ãŸã€‚